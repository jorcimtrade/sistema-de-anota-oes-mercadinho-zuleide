<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Financeiro Completo Pro</title> mercadinho zuleideüìä
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --dark: #1f2937;
            --light: #f9fafb;
            --gray: #6b7280;
            --pix: #00c9a7;
            --credit: #ff6b6b;
            --debit: #4ecdc4;
            --cash: #ffd93d;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .auth-container {
            max-width: 450px;
            margin: 50px auto;
            background: white;
            border-radius: 24px;
            padding: 50px 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo h1 {
            font-size: 32px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .logo p {
            color: var(--gray);
            font-size: 14px;
        }

        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 25px 35px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            flex-wrap: wrap;
            gap: 15px;
        }

        .header-left h1 {
            font-size: 28px;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .header-left p {
            color: var(--gray);
            font-size: 14px;
        }

        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .user-badge {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn {
            padding: 12px 28px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
            border: 2px solid #e5e7eb;
        }

        .btn-secondary:hover {
            background: white;
            border-color: var(--primary);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border-radius: 0 0 0 100px;
        }

        .stat-icon {
            font-size: 36px;
            margin-bottom: 12px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--gray);
            font-size: 13px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        @media (max-width: 1200px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light);
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 600;
            font-size: 14px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .payment-methods {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 10px;
        }

        .payment-option {
            padding: 15px;
            border: 3px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .payment-option:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .payment-option.selected {
            border-width: 3px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .payment-option.pix.selected {
            border-color: var(--pix);
            background: rgba(0, 201, 167, 0.1);
            color: var(--pix);
        }

        .payment-option.credito.selected {
            border-color: var(--credit);
            background: rgba(255, 107, 107, 0.1);
            color: var(--credit);
        }

        .payment-option.debito.selected {
            border-color: var(--debit);
            background: rgba(78, 205, 196, 0.1);
            color: var(--debit);
        }

        .payment-option.dinheiro.selected {
            border-color: var(--cash);
            background: rgba(255, 217, 61, 0.1);
            color: #e6b800;
        }

        .notes-container {
            max-height: 700px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .notes-container::-webkit-scrollbar {
            width: 6px;
        }

        .notes-container::-webkit-scrollbar-track {
            background: var(--light);
            border-radius: 10px;
        }

        .notes-container::-webkit-scrollbar-thumb {
            background: var(--gray);
            border-radius: 10px;
        }

        .note-item {
            background: var(--light);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s;
        }

        .note-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .note-header-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
            gap: 15px;
            flex-wrap: wrap;
        }

        .note-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--dark);
            flex: 1;
        }

        .note-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .note-profit-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
            white-space: nowrap;
        }

        .note-profit-badge.positive {
            background: #d1fae5;
            color: var(--success);
        }

        .note-profit-badge.negative {
            background: #fee2e2;
            color: var(--danger);
        }

        .payment-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 12px;
            white-space: nowrap;
        }

        .payment-badge.pix {
            background: rgba(0, 201, 167, 0.2);
            color: var(--pix);
        }

        .payment-badge.credito {
            background: rgba(255, 107, 107, 0.2);
            color: var(--credit);
        }

        .payment-badge.debito {
            background: rgba(78, 205, 196, 0.2);
            color: var(--debit);
        }

        .payment-badge.dinheiro {
            background: rgba(255, 217, 61, 0.2);
            color: #e6b800;
        }

        .note-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 12px;
            font-size: 13px;
            color: var(--gray);
            flex-wrap: wrap;
        }

        .note-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .note-content {
            color: #4b5563;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .note-actions {
            display: flex;
            gap: 10px;
        }

        .category-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            margin-left: 10px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .hidden {
            display: none !important;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 500;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background: #d1fae5;
            color: var(--success);
            border-left: 4px solid var(--success);
        }

        .alert-error {
            background: #fee2e2;
            color: var(--danger);
            border-left: 4px solid var(--danger);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .filter-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .payment-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .payment-stat-card {
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .payment-stat-card.pix {
            background: linear-gradient(135deg, rgba(0, 201, 167, 0.1), rgba(0, 201, 167, 0.2));
            border: 2px solid var(--pix);
        }

        .payment-stat-card.credito {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(255, 107, 107, 0.2));
            border: 2px solid var(--credit);
        }

        .payment-stat-card.debito {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.1), rgba(78, 205, 196, 0.2));
            border: 2px solid var(--debit);
        }

        .payment-stat-card.dinheiro {
            background: linear-gradient(135deg, rgba(255, 217, 61, 0.1), rgba(255, 217, 61, 0.2));
            border: 2px solid var(--cash);
        }

        .payment-stat-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .payment-stat-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .payment-stat-label {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div id="loginScreen" class="auth-container">
        <div class="logo">
            <h1>üíé Sistema de anota√ß√µes mercadinho zuleide </h1>
            <p>Sistema Financeiro Inteligente</p>
        </div>
        <div id="loginMessage"></div>
        <div class="form-group">
            <label class="form-label">Usu√°rio</label>
            <input type="text" class="form-input" id="loginUsername" placeholder="Seu usu√°rio">
        </div>
        <div class="form-group">
            <label class="form-label">Senha</label>
            <input type="password" class="form-input" id="loginPassword" placeholder="Sua senha">
        </div>
        <button class="btn btn-primary" style="width: 100%;" onclick="login()">
            üöÄ Entrar
        </button>
        <p style="text-align: center; margin-top: 20px; color: var(--gray);">
            N√£o tem conta? <a href="#" onclick="toggleAuth(); return false;" style="color: var(--primary); font-weight: 600;">Cadastre-se</a>
        </p>
    </div>

    <!-- Tela de Cadastro -->
    <div id="registerScreen" class="auth-container hidden">
        <div class="logo">
            <h1>üíé FinancePro</h1>
            <p>Crie sua conta gratuita</p>
        </div>
        <div id="registerMessage"></div>
        <div class="form-group">
            <label class="form-label">Usu√°rio</label>
            <input type="text" class="form-input" id="registerUsername" placeholder="Escolha um usu√°rio">
        </div>
        <div class="form-group">
            <label class="form-label">Senha</label>
            <input type="password" class="form-input" id="registerPassword" placeholder="Escolha uma senha">
        </div>
        <button class="btn btn-primary" style="width: 100%;" onclick="register()">
            ‚ú® Criar Conta
        </button>
        <p style="text-align: center; margin-top: 20px; color: var(--gray);">
            J√° tem conta? <a href="#" onclick="toggleAuth(); return false;" style="color: var(--primary); font-weight: 600;">Fa√ßa login</a>
        </p>
    </div>

    <!-- Sistema Principal -->
    <div id="mainSystem" class="main-container hidden">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <h1>üíé FinancePro</h1>
                <p id="currentDate"></p>
            </div>
            <div class="header-right">
                <div class="user-badge">
                    üë§ <span id="currentUser"></span>
                </div>
                <button class="btn btn-secondary btn-small" onclick="logout()">
                    üö™ Sair
                </button>
            </div>
        </div>

        <!-- Dashboard de Estat√≠sticas -->
        <div class="dashboard-grid">
            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-value" id="totalNotes">0</div>
                <div class="stat-label">Total de Transa√ß√µes</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-value" id="totalProfit">R$ 0,00</div>
                <div class="stat-label">Saldo Total</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìÖ</div>
                <div class="stat-value" id="monthProfit">R$ 0,00</div>
                <div class="stat-label">Saldo do M√™s</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìà</div>
                <div class="stat-value" id="avgProfit">R$ 0,00</div>
                <div class="stat-label">M√©dia por Transa√ß√£o</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-value" id="totalReceitas">R$ 0,00</div>
                <div class="stat-label">Total Receitas</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚ùå</div>
                <div class="stat-value" id="totalDespesas">R$ 0,00</div>
                <div class="stat-label">Total Despesas</div>
            </div>
        </div>

        <!-- Estat√≠sticas por Forma de Pagamento -->
        <div class="card full-width">
            <div class="card-header">
                <h2 class="card-title">üí≥ An√°lise por Forma de Pagamento</h2>
            </div>
            <div class="payment-stats-grid">
                <div class="payment-stat-card pix">
                    <div class="payment-stat-icon">üì±</div>
                    <div class="payment-stat-value" id="pixTotal">R$ 0,00</div>
                    <div class="payment-stat-label">PIX</div>
                </div>
                <div class="payment-stat-card credito">
                    <div class="payment-stat-icon">üí≥</div>
                    <div class="payment-stat-value" id="creditoTotal">R$ 0,00</div>
                    <div class="payment-stat-label">Cart√£o de Cr√©dito</div>
                </div>
                <div class="payment-stat-card debito">
                    <div class="payment-stat-icon">üí≥</div>
                    <div class="payment-stat-value" id="debitoTotal">R$ 0,00</div>
                    <div class="payment-stat-label">Cart√£o de D√©bito</div>
                </div>
                <div class="payment-stat-card dinheiro">
                    <div class="payment-stat-icon">üíµ</div>
                    <div class="payment-stat-value" id="dinheiroTotal">R$ 0,00</div>
                    <div class="payment-stat-label">Dinheiro</div>
                </div>
            </div>
        </div>

        <!-- Conte√∫do Principal -->
        <div class="content-grid">
            <!-- Formul√°rio de Nova Transa√ß√£o -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">‚ú® Nova Transa√ß√£o</h2>
                </div>
                <div class="form-group">
                    <label class="form-label">T√≠tulo *</label>
                    <input type="text" class="form-input" id="noteTitle" placeholder="Ex: Venda de Produto X">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Categoria *</label>
                        <select class="form-select" id="noteCategory">
                            <option value="vendas">üíº Vendas</option>
                            <option value="servicos">üîß Servi√ßos</option>
                            <option value="investimentos">üìà Investimentos</option>
                            <option value="despesas">üí∏ Despesas</option>
                            <option value="salario">üí∞ Sal√°rio</option>
                            <option value="outros">üìù Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tipo *</label>
                        <select class="form-select" id="noteType">
                            <option value="receita">‚úÖ Receita</option>
                            <option value="despesa">‚ùå Despesa</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o *</label>
                    <textarea class="form-textarea" id="noteContent" placeholder="Descreva os detalhes..."></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Valor (R$) *</label>
                        <input type="number" class="form-input" id="noteProfit" step="0.01" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data *</label>
                        <input type="date" class="form-input" id="noteDate">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Hora *</label>
                        <input type="time" class="form-input" id="noteTime">
                    </div>
                    <div class="form-group">
                        <label class="form-label">M√™s/Ano *</label>
                        <input type="month" class="form-input" id="noteMonth">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Forma de Pagamento *</label>
                    <div class="payment-methods">
                        <div class="payment-option pix" data-payment="pix">
                            üì± PIX
                        </div>
                        <div class="payment-option credito" data-payment="credito">
                            üí≥ Cr√©dito
                        </div>
                        <div class="payment-option debito" data-payment="debito">
                            üí≥ D√©bito
                        </div>
                        <div class="payment-option dinheiro" data-payment="dinheiro">
                            üíµ Dinheiro
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="addNote()">
                    üíæ Salvar Transa√ß√£o
                </button>
            </div>

            <!-- Gr√°fico -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìä Evolu√ß√£o Financeira</h2>
                </div>
                <div class="chart-container">
                    <canvas id="profitChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Lista de Transa√ß√µes -->
        <div class="card full-width">
            <div class="card-header">
                <h2 class="card-title">üìã Hist√≥rico de Transa√ß√µes</h2>
                <div class="filter-section">
                    <select class="form-select" id="filterMonth" onchange="filterNotes()" style="width: auto;">
                        <option value="all">Todos os Meses</option>
                    </select>
                    <select class="form-select" id="filterCategory" onchange="filterNotes()" style="width: auto;">
                        <option value="all">Todas Categorias</option>
                        <option value="vendas">üíº Vendas</option>
                        <option value="servicos">üîß Servi√ßos</option>
                        <option value="investimentos">üìà Investimentos</option>
                        <option value="despesas">üí∏ Despesas</option>
                        <option value="salario">üí∞ Sal√°rio</option>
                        <option value="outros">üìù Outros</option>
                    </select>
                    <select class="form-select" id="filterPayment" onchange="filterNotes()" style="width: auto;">
                        <option value="all">Todas Formas</option>
                        <option value="pix">üì± PIX</option>
                        <option value="credito">üí≥ Cr√©dito</option>
                        <option value="debito">üí≥ D√©bito</option>
                        <option value="dinheiro">üíµ Dinheiro</option>
                    </select>
                    <select class="form-select" id="filterType" onchange="filterNotes()" style="width: auto;">
                        <option value="all">Todos os Tipos</option>
                        <option value="receita">‚úÖ Receitas</option>
                        <option value="despesa">‚ùå Despesas</option>
                    </select>
                </div>
            </div>
            <div class="notes-container" id="notesList"></div>
        </div>
    </div>

    <script>
        let users = JSON.parse(localStorage.getItem('usersFinanceProSystem')) || {};
        let currentUser = localStorage.getItem('currentUserFinancePro');
        let profitChart = null;
        let selectedPayment = '';

        // Inicializa√ß√£o
        if (currentUser && users[currentUser]) {
            showMainSystem();
        }

        // Configurar data e hora atuais
        const now = new Date();
        document.getElementById('noteDate').valueAsDate = now;
        document.getElementById('noteTime').value = now.toTimeString().slice(0, 5);
        document.getElementById('noteMonth').value = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;

        // Sele√ß√£o de forma de pagamento
        document.querySelectorAll('.payment-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.payment-option').forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                selectedPayment = this.dataset.payment;
            });
        });

        function toggleAuth() {
            document.getElementById('loginScreen').classList.toggle('hidden');
            document.getElementById('registerScreen').classList.toggle('hidden');
            clearMessages();
        }

        function showMessage(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => element.innerHTML = '', 4000);
        }

        function clearMessages() {
            document.getElementById('loginMessage').innerHTML = '';
            document.getElementById('registerMessage').innerHTML = '';
        }

        function register() {
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value.trim();

            if (!username || !password) {
                showMessage('registerMessage', '‚ùå Preencha todos os campos!', 'error');
                return;
            }

            if (username.length < 3) {
                showMessage('registerMessage', '‚ùå Usu√°rio deve ter pelo menos 3 caracteres!', 'error');
                return;
            }

            if (password.length < 4) {
                showMessage('registerMessage', '‚ùå Senha deve ter pelo menos 4 caracteres!', 'error');
                return;
            }

            if (users[username]) {
                showMessage('registerMessage', '‚ùå Usu√°rio j√° existe!', 'error');
                return;
            }

            users[username] = {
                password: password,
                notes: [],
                createdAt: new Date().toISOString()
            };

            localStorage.setItem('usersFinanceProSystem', JSON.stringify(users));
            showMessage('registerMessage', '‚úÖ Cadastro realizado! Redirecionando...', 'success');
            
            setTimeout(() => {
                document.getElementById('registerUsername').value = '';
                document.getElementById('registerPassword').value = '';
                toggleAuth();
            }, 1500);
        }

        function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();

            if (!username || !password) {
                showMessage('loginMessage', '‚ùå Preencha todos os campos!', 'error');
                return;
            }

            if (!users[username] || users[username].password !== password) {
                showMessage('loginMessage', '‚ùå Usu√°rio ou senha incorretos!', 'error');
                return;
            }

            currentUser = username;
            localStorage.setItem('currentUserFinancePro', currentUser);
            showMainSystem();
        }

        function logout() {
            if (confirm('Deseja realmente sair?')) {
                currentUser = null;
                localStorage.removeItem('currentUserFinancePro');
                document.getElementById('mainSystem').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
                clearInputs();
            }
        }

        function showMainSystem() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('mainSystem').classList.remove('hidden');
            document.getElementById('currentUser').textContent = currentUser;
            updateCurrentDate();
            populateMonthFilter();
            loadNotes();
            updateAllStats();
            createProfitChart();
        }

        function updateCurrentDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('pt-BR', options);
        }

        function populateMonthFilter() {
            const select = document.getElementById('filterMonth');
            select.innerHTML = '<option value="all">Todos os Meses</option>';
            const months = new Set();
            
            users[currentUser].notes.forEach(note => {
                months.add(note.month);
            });

            const sortedMonths = Array.from(months).sort().reverse();
            
            sortedMonths.forEach(monthYear => {
                const [year, month] = monthYear.split('-');
                const date = new Date(year, month - 1);
                const monthName = date.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
                const option = document.createElement('option');
                option.value = monthYear;
                option.textContent = monthName.charAt(0).toUpperCase() + monthName.slice(1);
                select.appendChild(option);
            });
        }

        function addNote() {
            const title = document.getElementById('noteTitle').value.trim();
            const content = document.getElementById('noteContent').value.trim();
            const profit = parseFloat(document.getElementById('noteProfit').value);
            const category = document.getElementById('noteCategory').value;
            const type = document.getElementById('noteType').value;
            const dateInput = document.getElementById('noteDate').value;
            const timeInput = document.getElementById('noteTime').value;
            const monthInput = document.getElementById('noteMonth').value;

            if (!title || !content || isNaN(profit) || !selectedPayment || !dateInput || !timeInput) {
                alert('‚ùå Preencha todos os campos obrigat√≥rios!');
                return;
            }

            // Se for despesa, tornar o valor negativo
            const finalProfit = type === 'despesa' ? -Math.abs(profit) : Math.abs(profit);

            const note = {
                id: Date.now(),
                title: title,
                content: content,
                profit: finalProfit,
                category: category,
                type: type,
                payment: selectedPayment,
                date: dateInput,
                time: timeInput,
                month: monthInput,
                createdAt: new Date().toLocaleString('pt-BR')
            };

            users[currentUser].notes.unshift(note);
            localStorage.setItem('usersFinanceProSystem', JSON.stringify(users));

            clearInputs();
            populateMonthFilter();
            loadNotes();
            updateAllStats();
            createProfitChart();

            // Feedback visual
            const btn = event.target;
            btn.textContent = '‚úÖ Salvo!';
            btn.style.background = 'var(--success)';
            setTimeout(() => {
                btn.innerHTML = 'üíæ Salvar Transa√ß√£o';
                btn.style.background = '';
            }, 2000);
        }

        function deleteNote(id) {
            if (confirm('üóëÔ∏è Deseja realmente excluir esta transa√ß√£o?')) {
                users[currentUser].notes = users[currentUser].notes.filter(note => note.id !== id);
                localStorage.setItem('usersFinanceProSystem', JSON.stringify(users));
                loadNotes();
                updateAllStats();
                createProfitChart();
            }
        }

        function filterNotes() {
            loadNotes();
        }

        function loadNotes() {
            const notesList = document.getElementById('notesList');
            let notes = [...users[currentUser].notes];

            // Filtrar por m√™s
            const filterMonth = document.getElementById('filterMonth').value;
            if (filterMonth !== 'all') {
                notes = notes.filter(note => note.month === filterMonth);
            }

            // Filtrar por categoria
            const filterCategory = document.getElementById('filterCategory').value;
            if (filterCategory !== 'all') {
                notes = notes.filter(note => note.category === filterCategory);
            }

            // Filtrar por forma de pagamento
            const filterPayment = document.getElementById('filterPayment').value;
            if (filterPayment !== 'all') {
                notes = notes.filter(note => note.payment === filterPayment);
            }

            // Filtrar por tipo
            const filterType = document.getElementById('filterType').value;
            if (filterType !== 'all') {
                notes = notes.filter(note => note.type === filterType);
            }

            if (notes.length === 0) {
                notesList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <h3>Nenhuma transa√ß√£o encontrada</h3>
                        <p>Comece criando sua primeira transa√ß√£o!</p>
                    </div>
                `;
                return;
            }

            const categoryIcons = {
                vendas: 'üíº',
                servicos: 'üîß',
                investimentos: 'üìà',
                despesas: 'üí∏',
                salario: 'üí∞',
                outros: 'üìù'
            };

            const paymentLabels = {
                pix: 'üì± PIX',
                credito: 'üí≥ Cr√©dito',
                debito: 'üí≥ D√©bito',
                dinheiro: 'üíµ Dinheiro'
            };

            notesList.innerHTML = notes.map(note => {
                const noteDate = new Date(note.date);
                const formattedDate = noteDate.toLocaleDateString('pt-BR', { 
                    day: '2-digit', 
                    month: 'long', 
                    year: 'numeric' 
                });
                const profitClass = note.profit >= 0 ? 'positive' : 'negative';
                const profitSign = note.profit >= 0 ? '+' : '';
                
                return `
                    <div class="note-item">
                        <div class="note-header-item">
                            <div style="flex: 1;">
                                <div class="note-title">
                                    ${note.title}
                                    <span class="category-badge" style="background: rgba(99, 102, 241, 0.1); color: var(--primary);">
                                        ${categoryIcons[note.category]} ${note.category.charAt(0).toUpperCase() + note.category.slice(1)}
                                    </span>
                                </div>
                            </div>
                            <div class="note-badges">
                                <div class="note-profit-badge ${profitClass}">
                                    ${profitSign}R$ ${Math.abs(note.profit).toFixed(2)}
                                </div>
                                <div class="payment-badge ${note.payment}">
                                    ${paymentLabels[note.payment]}
                                </div>
                            </div>
                        </div>
                        <div class="note-meta">
                            <span>üìÖ ${formattedDate}</span>
                            <span>üïê ${note.time}</span>
                            <span>üìÜ ${note.month}</span>
                            <span>üíæ ${note.createdAt}</span>
                        </div>
                        <div class="note-content">${note.content}</div>
                        <div class="note-actions">
                            <button class="btn btn-danger btn-small" onclick="deleteNote(${note.id})">
                                üóëÔ∏è Excluir
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateAllStats() {
            const notes = users[currentUser].notes;
            const totalNotes = notes.length;
            const totalProfit = notes.reduce((sum, note) => sum + note.profit, 0);
            const avgProfit = totalNotes > 0 ? totalProfit / totalNotes : 0;

            // Receitas e Despesas
            const receitas = notes.filter(n => n.profit > 0).reduce((sum, note) => sum + note.profit, 0);
            const despesas = notes.filter(n => n.profit < 0).reduce((sum, note) => sum + Math.abs(note.profit), 0);

            // Lucro do m√™s atual
            const now = new Date();
            const currentMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
            const monthNotes = notes.filter(note => note.month === currentMonth);
            const monthProfit = monthNotes.reduce((sum, note) => sum + note.profit, 0);

            // Por forma de pagamento
            const pixTotal = notes.filter(n => n.payment === 'pix').reduce((sum, note) => sum + note.profit, 0);
            const creditoTotal = notes.filter(n => n.payment === 'credito').reduce((sum, note) => sum + note.profit, 0);
            const debitoTotal = notes.filter(n => n.payment === 'debito').reduce((sum, note) => sum + note.profit, 0);
            const dinheiroTotal = notes.filter(n => n.payment === 'dinheiro').reduce((sum, note) => sum + note.profit, 0);

            // Atualizar DOM
            document.getElementById('totalNotes').textContent = totalNotes;
            document.getElementById('totalProfit').textContent = `R$ ${totalProfit.toFixed(2)}`;
            document.getElementById('monthProfit').textContent = `R$ ${monthProfit.toFixed(2)}`;
            document.getElementById('avgProfit').textContent = `R$ ${avgProfit.toFixed(2)}`;
            document.getElementById('totalReceitas').textContent = `R$ ${receitas.toFixed(2)}`;
            document.getElementById('totalDespesas').textContent = `R$ ${despesas.toFixed(2)}`;

            document.getElementById('pixTotal').textContent = `R$ ${pixTotal.toFixed(2)}`;
            document.getElementById('creditoTotal').textContent = `R$ ${creditoTotal.toFixed(2)}`;
            document.getElementById('debitoTotal').textContent = `R$ ${debitoTotal.toFixed(2)}`;
            document.getElementById('dinheiroTotal').textContent = `R$ ${dinheiroTotal.toFixed(2)}`;
        }

        function createProfitChart() {
            const ctx = document.getElementById('profitChart');
            if (!ctx) return;

            const notes = users[currentUser].notes;
            
            // Agrupar por m√™s
            const monthlyData = {};
            notes.forEach(note => {
                const monthKey = note.month;
                if (!monthlyData[monthKey]) {
                    monthlyData[monthKey] = 0;
                }
                monthlyData[monthKey] += note.profit;
            });

            // Ordenar e pegar √∫ltimos 6 meses
            const sortedMonths = Object.keys(monthlyData).sort().slice(-6);
            const labels = sortedMonths.map(key => {
                const [year, month] = key.split('-');
                const date = new Date(year, month - 1);
                return date.toLocaleDateString('pt-BR', { month: 'short', year: '2-digit' });
            });
            const data = sortedMonths.map(key => monthlyData[key]);

            if (profitChart) {
                profitChart.destroy();
            }

            profitChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Saldo Mensal',
                        data: data,
                        borderColor: 'rgb(99, 102, 241)',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'R$ ' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toFixed(0);
                                }
                            }
                        }
                    }
                }
            });
        }

        function clearInputs() {
            document.getElementById('noteTitle').value = '';
            document.getElementById('noteContent').value = '';
            document.getElementById('noteProfit').value = '';
            document.getElementById('noteCategory').value = 'vendas';
            document.getElementById('noteType').value = 'receita';
            
            const now = new Date();
            document.getElementById('noteDate').valueAsDate = now;
            document.getElementById('noteTime').value = now.toTimeString().slice(0, 5);
            document.getElementById('noteMonth').value = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
            
            document.querySelectorAll('.payment-option').forEach(opt => opt.classList.remove('selected'));
            selectedPayment = '';
        }
    </script>
</body>
</html>